---
author: amosk
comments: true
date: 2010-06-26 23:49:22+00:00
layout: post
slug: kvm-network-model
title: KVM Network Model
wordpress_id: 470
categories:
- Virtualization
---

[1] Userspace Virtio network architecture
    [2] Vd-t,sriov architecture
    [3] Vhost_net architecture
    [4] Vhost over sriov & macvtap architecture
    
          +--------------+
          |  Guest VM    |
          | +--+    +--+ |
          +-|  |----|  |-+
            |tx|    |rx|
          +-+--+----+--+-+
          |   \ QEMU  ^  |
          |    v     /   |
          |    +----+    |
          +----| tap|----+
      +--------|    |--------+
      |        +----+        |
      |Kernel/HV  ^          |
      |           |          |
      |           v          |
      |       +------+       |
      |       |bridge|       |
      |       +------+       |
      |           ^          |
      |           |          |
      |           v          |
      |       +------+       |
      +-------| NIC  |-------+
              +------+
                  ^
                  |
                  v
    
          +------------------------+
          |     Guest VM           |
          |              +--+ +--+ |
          +--------------|tx|-|rx|-+
                         +--+ +--+
                           ^   ^
                            \ /
                             |
                             v
          +--------+   +-----------+
          | QEMU   |   | VF NIC #2 |
          +--------+   +-----------+
      +----------------------+  ^
      | Kernel/HV            |  |
      |    +-----------+     |  |
      |    | VF NIC #1 |     |  |
      |    +-----------+     |  |
      |           ^          |  |
      |           |          |  |
      |           v          |  v
      |       +--------------+----+
      +-------| Physical NIC      |
              +-------------------+
                  ^
                  |
                  v
    
          +------------------------+
          |     Guest VM           |
          |              +--+ +--+ |
          +--------------|tx|-|rx|-+
                         +--+ +--+
           +--------+      ^   ^
           | QEMU   |       \ /
           +--------+        |
      +----------------------|------+
      | Kernel/HV            v      |
      |                 +-------+   |
      |             +-> | vhost |   |
      |             |   +-------+   |
      |             v               |
      |       +------+              |
      |       | tap  |              |
      |       +------+              |
      |           ^                 |
      |           |                 |
      |           v                 |
      |       +------+              |
      |       |bridge|              |
      |       +------+              |
      |           ^                 |
      |           |                 |
      |           v                 |
      |       +------+              |
      +-------| NIC  |--------------+
              +------+
                  ^
                  |
                  v
    
          +------------------------+
          |     Guest VM           |
          |              +--+ +--+ |
          +--------------|tx|-|rx|-+
                         +--+ +--+
           +--------+      ^   ^
           | QEMU   |       \ /
           +--------+        |
      +----------------------|------+
      | Kernel/HV            v      |
      |                 +-------+   |
      |             +-> | vhost |   |
      |             |   +-------+   |
      |             v               |
      |       +---------+           |
      |       | macvtap |           |
      |       +---------+           |
      |           ^                 |
      |           |                 |
      |           v                 |
      | +-----------+ +-----------+ |
      | | VF NIC #2 | | VF NIC #1 | |
      | +-----------+ +-----------+ |
      |           ^      ^          |
      |           |      |          |
      |           v      v          |
      |       +---------------+     |
      +-------| Physical NIC  |-----+
              +---------------+
                      ^
                      |
                      v
    
